<?xml version="1.0" encoding="UTF-8"?>

<project 
    name="apache-httpd" 
    default="build-httpd"
    basedir=".">

  <property name="version" value="1.0"/>

  <!-- Define Directories. -->

  <property name="binname" value="httpd-2.2.9" />
  <property name="targz" value="dist/${binname}.tar.gz" />
  <property name="root" value="${basedir}/root" />
  <property name="httpd" value="${root}/bin/httpd" />
  <property name="apachectl" value="${root}/bin/apachectl" />
  <property name="srcdir" value="${basedir}/src" />
  <property name="src" value="${srcdir}/${binname}" />

  <!-- common targets -->
  <target name="init">    
    <!-- setup environment -->
    <tstamp>
      <format property="timestamp" pattern="MMddyyyyhhmm"/>
    </tstamp>
    <mkdir dir="${root}"/>
    <mkdir dir="${src}"/>
  </target>

  <target name="clean" description="Deletes all build files.">
    <delete dir="${srcdir}" />
    <delete dir="${root}" />
  </target>

  <target name="untar" depends="init">
    <exec 
        dir="${srcdir}"
        executable="tar">
      <arg line="xvzf ../${targz}"/>
    </exec>
  </target>

  <target name="configure" depends="untar">
    <exec 
        dir="${src}"
        executable="sh">
      <arg value="configure"/>
      <arg value="--enable-ssl"/>
      <arg value="--enable-proxy-connect"/>
      <arg value="--enable-proxy"/>
      <arg value="--enable-proxy-http"/>
      <arg value="--enable-static-htpasswd"/>
      <arg value="--enable-rewrite"/>
      <arg value="--prefix=${root}"/>
    </exec>
  </target>

  <target name="make" depends="configure">
    <exec
        dir="${src}"
        executable="make">
    </exec>
  </target>

  <target name="install" depends="configure"> 
    <exec
        dir="${src}"
        executable="make">
      <arg value="install"/>
    </exec>
  </target>

  <!-- Build detection targets.  We dont want to rebuild unless we have to. -->
  <target name="build-httpd" depends="already-built-msg" unless="httpd-present">
    <ant dir="." target="install"/>
  </target>

  <target name="already-built">
    <available property="httpd-present" file="root/bin/httpd"/>
  </target>
  
  <target name="already-built-msg" depends="already-built" if="httpd-present">
    <echo message="httpd already built"/>
  </target>

</project>

